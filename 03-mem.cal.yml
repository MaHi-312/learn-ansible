- name: print used Memory
  hosts: localhost
  tasks:
    - name: Get Memory
      ansible.builtin.shell: free | grep Mem | xargs
      register: free

    - name: set a fact
      ansible.builtin.set_fact:
        FREE: "{{free.stdout | split(' ') }}"

    - name: print free variable
      ansible.builtin.set_fact:
        total: "{{ FREE[1] }}"
        free: "{{ FREE[3] }}"
        used_mem: "{{ 100 - (free[1]|int / free[3]|int * 100) }}"

    - name: print free output
      ansible.builtin.debug:
        msg: "{{ free |int / total |int * 100 }}"
